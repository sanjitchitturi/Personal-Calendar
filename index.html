<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Milestone Calendar — Apr 9, 2005 →</title>
  <style>
    :root{
      --bg:#f6f8fb; --card:#fff; --muted:#6b7280; --text:#0f1722; --accent:#0066ff; --accent-2:#20c997; --radius:14px; --shadow:0 10px 30px rgba(12,20,35,0.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:linear-gradient(180deg,#eef6ff 0%,var(--bg) 100%);-webkit-font-smoothing:antialiased}
    .wrap{max-width:980px;margin:28px auto;padding:18px}
    header{display:flex;gap:14px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#7c4dff);display:grid;place-items:center;color:white;font-weight:800;box-shadow:0 8px 30px rgba(7,94,230,0.12)}
    .title{font-size:18px;font-weight:700}
    .subtitle{font-size:13px;color:var(--muted)}

    .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
    .btn{background:var(--card);border:1px solid rgba(12,20,35,0.06);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700;min-height:40px}
    .btn.ghost{background:transparent;border:1px dashed rgba(12,20,35,0.05)}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#6d28d9);color:white;border:0}

    .layout{display:grid;grid-template-columns:320px 1fr;gap:16px;margin-top:16px}
    @media (max-width:920px){.layout{grid-template-columns:1fr}}

    .panel{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px}
    .big{font-size:24px;font-weight:900}

    .stat-row{display:flex;gap:10px}
    .stat{flex:1;background:linear-gradient(180deg,rgba(6,102,255,0.04),transparent);padding:10px;border-radius:10px}
    .stat .label{font-size:12px;color:var(--muted)}
    .stat .value{font-weight:800;font-size:16px}

    .progress{height:12px;background:#eef3ff;border-radius:999px;overflow:hidden;border:1px solid rgba(12,20,35,0.03)}
    .progress > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#7c4dff);transition:width .5s ease}

    .chip{padding:8px 10px;background:#fbfdff;border:1px solid rgba(12,20,35,0.04);border-radius:999px;font-weight:700}

    .header-row{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    .month-title{font-weight:800;font-size:18px}
    .weekdays, .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
    .weekday{font-size:12px;color:var(--muted);text-align:center}

    .day{background:linear-gradient(180deg,#fff,#fbfdff);border-radius:10px;padding:10px;min-height:86px;border:1px solid rgba(12,20,35,0.04);display:flex;flex-direction:column;justify-content:space-between;cursor:pointer;position:relative;transition:transform .08s ease,box-shadow .12s ease}
    .day:hover{transform:translateY(-6px);box-shadow:0 18px 36px rgba(12,20,35,0.08)}
    .day.ghost{background:transparent;border:0;opacity:.28;pointer-events:none}
    .num{font-weight:800;font-size:16px}
    .meta{font-size:12px;color:var(--muted)}

    .past{opacity:.62}
    .completed .num{text-decoration:line-through;color:var(--muted)}
    .check{position:absolute;right:10px;top:10px;background:var(--accent-2);color:white;width:26px;height:26px;border-radius:8px;display:grid;place-items:center;font-weight:800;transform:scale(.9);transition:transform .12s ease}
    .day.completed .check{transform:scale(1.05)}

    .today{outline:3px solid rgba(6,102,255,0.08);box-shadow:inset 0 0 0 1px rgba(6,102,255,0.04)}

    .footer{display:flex;justify-content:space-between;margin-top:12px;font-size:13px;color:var(--muted)}
    .sparkle{position:absolute;left:10px;bottom:10px;width:14px;height:14px;border-radius:50%;background:linear-gradient(90deg,#fff6,#ffd6);opacity:0;transition:opacity .25s ease}
    .day.completed .sparkle{opacity:1}
    @media (max-width:520px){ .day{min-height:68px;padding:8px} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">MC</div>
      <div>
        <div class="title">Milestone Calendar</div>
        <div class="subtitle">Since Apr 9, 2005 — clean, modern, playful</div>
      </div>

      <div class="controls">
        <button class="btn ghost" id="exportBtn" title="Download manual marks (JSON)">Export</button>
        <label class="btn" style="display:inline-flex;align-items:center;gap:8px;cursor:pointer">
          Import
          <input id="importFile" type="file" accept="application/json" style="display:none">
        </label>
        <button class="btn" id="jumpStart">Start</button>
        <button class="btn primary" id="todayBtn">Today</button>
      </div>
    </header>

    <div class="layout">
      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="subtitle">Lifetime</div>
            <div class="big" id="totalDays">—</div>
          </div>
          <div style="text-align:right">
            <div class="subtitle">Since</div>
            <div style="font-weight:800">Apr 9, 2005</div>
          </div>
        </div>

        <div class="stat-row" style="margin-top:12px">
          <div class="stat"><div class="label">Days passed</div><div class="value" id="passedDays">—</div></div>
          <div class="stat"><div class="label">Manual marks</div><div class="value" id="manualMarks">—</div></div>
        </div>

        <div class="progress" title="% of passed days you've manually marked" style="margin-top:12px">
          <i id="progressBar"></i>
        </div>

        <div style="display:flex;gap:8px;align-items:center;margin-top:12px">
          <div class="chip">Current streak: <span id="curStreak">—</span></div>
          <div class="chip">Longest: <span id="longStreak">—</span></div>
        </div>

        <div class="subtitle" style="margin-top:10px">Click a day to toggle a manual mark. Past days are auto-completed. Manual marks are stored in your browser.</div>
      </div>

      <div>
        <div class="panel">
          <div class="header-row">
            <div style="display:flex;gap:8px;align-items:center">
              <button class="btn" id="prevBtn">◀</button>
              <div class="month-title" id="monthTitle">Month</div>
              <button class="btn" id="nextBtn">▶</button>
            </div>
            <div style="margin-left:auto;color:var(--muted)">Local: <span id="now"></span></div>
          </div>

          <div class="weekdays" id="weekdays"></div>
          <div class="grid" id="grid" aria-live="polite"></div>

          <div class="footer">
            <div class="subtitle">Tip: Host on GitHub Pages and link to it from your profile README.</div>
            <div>
              <button class="btn ghost" id="resetAll">Reset</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Config & small helpers (single-place definitions)
    const START = atMid(new Date(2005,3,9)); // Apr 9, 2005
    const WEEK_START = 1; // Monday
    const STORE = 'milestone:marks:final';

    function atMid(d){ const x=new Date(d); x.setHours(0,0,0,0); x.setMilliseconds(0); return x }
    function key(d){ return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}` }
    function daysBetween(a,b){ const ms=24*60*60*1000; return Math.floor((atMid(b)-atMid(a))/ms)+1 }
    function monthName(y,m){ return new Date(y,m,1).toLocaleString(undefined,{month:'long', year:'numeric'}) }
    function dim(y,m){ return new Date(y,m+1,0).getDate() }
    function offset(y,m){ const dow = new Date(y,m,1).getDay(); return (dow - WEEK_START + 7) % 7 }
    function isPast(d){ return atMid(d) < atMid(new Date()) }

    function read(){ try{return JSON.parse(localStorage.getItem(STORE))||{} }catch{return{}} }
    function write(s){ localStorage.setItem(STORE, JSON.stringify(s)) }

    // DOM refs
    const grid = document.getElementById('grid');
    const weekdaysEl = document.getElementById('weekdays');
    const monthTitle = document.getElementById('monthTitle');
    const nowEl = document.getElementById('now');
    const totalDaysEl = document.getElementById('totalDays');
    const passedDaysEl = document.getElementById('passedDays');
    const manualMarksEl = document.getElementById('manualMarks');
    const progressBar = document.getElementById('progressBar');
    const curStreakEl = document.getElementById('curStreak');
    const longStreakEl = document.getElementById('longStreak');

    // State
    let view = atMid(new Date());

    const weekdayLabels = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

    // Render helpers
    function renderWeekdays(){ const order = Array.from({length:7},(_,i)=>(i+WEEK_START)%7); weekdaysEl.innerHTML = order.map(i=>`<div class="weekday">${weekdayLabels[i]}</div>`).join('') }

    // Calendar
    function renderCalendar(){
      renderWeekdays();
      const y = view.getFullYear(), m = view.getMonth();
      monthTitle.textContent = monthName(y,m);
      const off = offset(y,m), days = dim(y,m);
      const store = read();
      const items = [];
      for(let i=0;i<off;i++) items.push('<div class="day ghost"></div>');
      for(let d=1; d<=days; d++){
        const dt = atMid(new Date(y,m,d)); const k = key(dt);
        const past = isPast(dt);
        const manual = !!store[k];
        const completed = past || manual;
        const isToday = dt.getTime() === atMid(new Date()).getTime();
        items.push(`\
          <button class="day ${past? 'past':''} ${completed? 'completed':''} ${isToday? 'today':''}" data-date="${k}">\
            <div style=\"display:flex;justify-content:space-between;align-items:flex-start\">\
              <div class=\"num\">${d}</div>\
              ${manual? '<div class="check">✓</div>' : ''}\
            </div>\
            <div class=\"meta\">${dt.toLocaleDateString(undefined,{weekday:'short',month:'short',day:'numeric'})}</div>\
            <div class=\"sparkle\"></div>\
          </button>\
        `);
      }
      grid.innerHTML = items.join('');
      grid.querySelectorAll('.day').forEach(b=>b.addEventListener('click', ()=>{ const k=b.getAttribute('data-date'); toggleMark(k); }));
    }

    function toggleMark(k){ const s = read(); if(s[k]) delete s[k]; else s[k] = true; write(s); render(); }

    // Stats
    function computeStats(){
      const store = read();
      const total = daysBetween(START, atMid(new Date()));
      const passed = daysBetween(START, atMid(new Date(Date.now()-86400000)));
      const manualKeys = Object.keys(store);
      const manual = manualKeys.length;

      // streaks (manual-only)
      let longest = 0, cur = 0, currentStreak = 0;
      for(let i=0;i<total;i++){
        const d = new Date(START.getTime() + i*86400000); const k = key(atMid(d));
        if(store[k]){ cur++; longest = Math.max(longest, cur); } else { cur = 0; }
      }
      for(let i=total-1;i>=0;i--){ const d = new Date(START.getTime()+i*86400000); const k = key(atMid(d)); if(store[k]) currentStreak++; else break }

      // completed (union of passed days + manual marks)
      const completedSet = new Set();
      for(let i=0;i<passed;i++){ const d = new Date(START.getTime()+i*86400000); completedSet.add(key(atMid(d))); }
      manualKeys.forEach(k=>completedSet.add(k));

      const completed = completedSet.size;
      const percentManualOfPassed = passed? Math.round((manual/passed)*100):0;
      return { total, passed, manual, completed, longest, currentStreak, percentManualOfPassed };
    }

    function renderStats(){ const s = computeStats(); totalDaysEl.textContent = s.total.toLocaleString(); passedDaysEl.textContent = s.passed.toLocaleString(); manualMarksEl.textContent = s.manual.toLocaleString(); progressBar.style.width = s.percentManualOfPassed + '%'; curStreakEl.textContent = s.currentStreak; longStreakEl.textContent = s.longest; }

    // Export / Import
    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const data = read();
      const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'milestone-marks.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    document.getElementById('importFile').addEventListener('change', (e)=>{
      const f = e.target.files && e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload = ()=>{ try{ const obj = JSON.parse(r.result); if(confirm('Import will replace current manual marks. Continue?')){ localStorage.setItem(STORE, JSON.stringify(obj)); render(); alert('Imported.'); } }catch(err){ alert('Invalid JSON'); } }; r.readAsText(f); e.target.value='';
    });

    // Controls
    document.getElementById('prevBtn').addEventListener('click', ()=>{ view = new Date(view.getFullYear(), view.getMonth()-1, 1); render(); });
    document.getElementById('nextBtn').addEventListener('click', ()=>{ view = new Date(view.getFullYear(), view.getMonth()+1, 1); render(); });
    document.getElementById('todayBtn').addEventListener('click', ()=>{ view = atMid(new Date()); render(); });
    document.getElementById('jumpStart').addEventListener('click', ()=>{ view = new Date(START.getFullYear(), START.getMonth(), 1); render(); });
    document.getElementById('resetAll').addEventListener('click', ()=>{ if(confirm('Clear ALL manual marks in this browser?')){ localStorage.removeItem(STORE); render(); } });

    // Boot
    function render(){ renderCalendar(); renderStats(); nowEl.textContent = new Date().toLocaleString(); }
    render();
    setInterval(()=>{ nowEl.textContent = new Date().toLocaleString(); },30000);
  </script>
</body>
</html>
