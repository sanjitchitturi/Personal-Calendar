<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sanjit Chitturi Life Calendar</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background:#f9f9f9; color:#333; display:flex; flex-direction:column; align-items:center; padding:20px;}
  h1 { margin-bottom: 5px; }
  #calendar { display: grid; grid-template-columns: repeat(7, 40px); gap: 4px; margin: 20px 0; }
  .day { width: 40px; height: 40px; display:flex; justify-content:center; align-items:center; cursor:pointer; border-radius:4px; transition:0.2s; }
  .day.past { background:#eee; color:#999; }
  .day.marked { background:#4caf50; color:#fff; }
  .day:hover { transform: scale(1.1); }
  #controls { margin-bottom: 15px; }
  button { margin:2px; padding:5px 10px; border:none; border-radius:4px; cursor:pointer; background:#2196F3; color:white; transition:0.2s; }
  button:hover { background:#1976D2; }
  #stats { margin-top:10px; }
</style>
</head>
<body>

<h1>Sanjit Chitturi Life Calendar</h1>
<div id="controls">
  <button id="prevMonth">Prev</button>
  <button id="nextMonth">Next</button>
  <button id="jumpStart">Jump to Start</button>
  <button id="jumpToday">Today</button>
  <button id="exportMarks">Export</button>
  <button id="importMarks">Import</button>
  <button id="resetMarks">Reset</button>
</div>

<div id="calendar"></div>
<div id="stats"></div>

<script>
const START = new Date(2005,3,9); // April 9, 2005 (months 0-based)
const WEEK_START = 0; // 0=Sunday, 1=Monday
let currentDate = new Date();
let currentMonth = currentDate.getMonth();
let currentYear = currentDate.getFullYear();
let manualMarks = JSON.parse(localStorage.getItem('milestone:marks:final') || '{}');

function atMid(date) { return new Date(date.getFullYear(), date.getMonth(), date.getDate()); }

function saveMarks() { localStorage.setItem('milestone:marks:final', JSON.stringify(manualMarks)); }

function renderCalendar(year, month) {
    const calendar = document.getElementById('calendar');
    calendar.innerHTML = '';
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month+1, 0).getDate();
    
    // padding empty cells
    for(let i=0; i<(firstDay-WEEK_START+7)%7; i++) {
        const empty = document.createElement('div');
        calendar.appendChild(empty);
    }
    
    for(let d=1; d<=daysInMonth; d++) {
        const dayEl = document.createElement('div');
        dayEl.textContent = d;
        dayEl.className = 'day';
        const thisDate = new Date(year, month, d);
        if(thisDate < atMid(new Date())) dayEl.classList.add('past');
        if(manualMarks[thisDate.toDateString()]) dayEl.classList.add('marked');
        
        dayEl.onclick = () => {
            const key = thisDate.toDateString();
            if(manualMarks[key]) delete manualMarks[key];
            else manualMarks[key] = true;
            saveMarks();
            renderCalendar(currentYear, currentMonth);
            updateStats();
        }
        calendar.appendChild(dayEl);
    }
}

function updateStats() {
    const now = atMid(new Date());
    const start = atMid(START);
    const totalDays = Math.floor((now - start)/(1000*60*60*24))+1;
    const passedDays = totalDays; // all past days auto-completed
    const manualCount = Object.keys(manualMarks).length;
    const completion = ((passedDays + manualCount)/totalDays*100).toFixed(1);
    
    document.getElementById('stats').innerHTML = `
        Total Days: ${totalDays} <br>
        Manual Marks: ${manualCount} <br>
        Completion %: ${completion}%
    `;
}

// Controls
document.getElementById('prevMonth').onclick = () => { currentMonth--; if(currentMonth<0){currentMonth=11; currentYear--;} renderCalendar(currentYear, currentMonth); }
document.getElementById('nextMonth').onclick = () => { currentMonth++; if(currentMonth>11){currentMonth=0; currentYear++;} renderCalendar(currentYear, currentMonth); }
document.getElementById('jumpStart').onclick = () => { currentMonth=START.getMonth(); currentYear=START.getFullYear(); renderCalendar(currentYear, currentMonth); }
document.getElementById('jumpToday').onclick = () => { currentDate=new Date(); currentMonth=currentDate.getMonth(); currentYear=currentDate.getFullYear(); renderCalendar(currentYear, currentMonth); }
document.getElementById('resetMarks').onclick = () => { if(confirm("Clear all manual marks?")){manualMarks={}; saveMarks(); renderCalendar(currentYear, currentMonth); updateStats();} }
document.getElementById('exportMarks').onclick = () => {
    const blob = new Blob([JSON.stringify(manualMarks,null,2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'milestone-marks.json';
    a.click();
}
document.getElementById('importMarks').onclick = () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = e => {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = () => {
            try {
                manualMarks = JSON.parse(reader.result);
                saveMarks();
                renderCalendar(currentYear, currentMonth);
                updateStats();
            } catch { alert('Invalid JSON'); }
        }
        reader.readAsText(file);
    }
    input.click();
}

renderCalendar(currentYear, currentMonth);
updateStats();
</script>

</body>
</html>
